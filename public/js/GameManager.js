// Generated by CoffeeScript 1.9.1
var GameManager;

GameManager = (function() {
  function GameManager() {
    this.events = new Events(this);
    this.network = new Network(this, this.events);
    this.scores = null;
    this.leftPlayer = 0;
    this.rightPlayer = 1;
    this.objects = [
      new Player($("#player1"), true, this, this.events), new Player($("#player2"), null, this, this.events), new Ball($(".ball"), {
        x: 275,
        y: -275
      }, this)
    ];
    this.ready = this.paused = false;
  }

  GameManager.prototype.updateScores = function(_scores) {
    var scoreText;
    scoreText = $("#score");
    this.scores = _scores || this.scores;
    if (this.network.host || (_scores != null)) {
      scoreText.text(this.scores[0] + " - " + this.scores[1]);
      scoreText.css("left", pongScreen.width / 2 - scoreText.width() / 2);
    }
    if (this.network.host) {
      return this.network.emitScores(this.scores);
    }
  };

  GameManager.prototype.startGame = function(speed) {
    var i, len, object, ref, results;
    ref = this.objects;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      object = ref[i];
      if (object instanceof Ball) {
        results.push(object.speed = speed);
      }
    }
    return results;
  };

  GameManager.prototype.restart = function() {
    var i, len, object, ref;
    ref = this.objects;
    for (i = 0, len = ref.length; i < len; i++) {
      object = ref[i];
      object.restart();
    }
    return this.updateScores([0, 0]);
  };

  GameManager.prototype.pause = function() {
    this.paused = !this.paused;
    return $("#paused").toggle();
  };

  GameManager.prototype.gameLoop = function() {
    var frameCount, self;
    frameCount = 0;
    self = this;
    return setInterval(function() {
      var i, len, object, ref;
      if (self.ready && !self.paused) {
        ref = self.objects;
        for (i = 0, len = ref.length; i < len; i++) {
          object = ref[i];
          object.update();
        }
        if (self.network.host) {
          if (++frameCount >= 1) {
            frameCount = 0;
            return self.network.emitBall(self.objects[2]);
          }
        }
      }
    }, 1000 / 60);
  };

  return GameManager;

})();
